import modelParser from "../src/utils/modelParser";

const modelFragment = "<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n<model type=\"com.apple.IDECoreDataModeler.DataModel\" documentVersion=\"1.0\" lastSavedToolsVersion=\"15702\" systemVersion=\"18G9323\" minimumToolsVersion=\"Automatic\" sourceLanguage=\"Swift\" userDefinedModelVersionIdentifier=\"\">\n    <entity name=\"NOActivity\" representedClassName=\"NOActivity\" syncable=\"YES\">\n        <attribute name=\"active\" attributeType=\"Boolean\" defaultValueString=\"YES\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"activityName\" optional=\"YES\" attributeType=\"String\" minValueString=\"1\" maxValueString=\"1000\"/>\n        <attribute name=\"activityNameArabic\" optional=\"YES\" attributeType=\"String\" minValueString=\"1\" maxValueString=\"1000\"/>\n        <attribute name=\"activityTime\" optional=\"YES\" attributeType=\"Date\" usesScalarValueType=\"NO\"/>\n        <attribute name=\"caloriesBurnt\" attributeType=\"Double\" minValueString=\"0\" maxValueString=\"100000\" defaultValueString=\"0.0\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"createdAt\" attributeType=\"Date\" usesScalarValueType=\"NO\"/>\n        <attribute name=\"duration\" attributeType=\"Double\" minValueString=\"0\" maxValueString=\"1000000\" defaultValueString=\"0.0\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"exerciseType\" attributeType=\"String\" minValueString=\"1\" maxValueString=\"100\"/>\n        <attribute name=\"isSuitableForPush\" optional=\"YES\" attributeType=\"Boolean\" defaultValueString=\"NO\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"met\" optional=\"YES\" attributeType=\"Double\" minValueString=\"0\" maxValueString=\"50\" defaultValueString=\"1\" usesScalarValueType=\"NO\"/>\n        <attribute name=\"syncRevision\" optional=\"YES\" attributeType=\"Integer 64\" defaultValueString=\"0\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"updatedAt\" attributeType=\"Date\" usesScalarValueType=\"NO\"/>\n        <attribute name=\"uuid\" attributeType=\"UUID\" usesScalarValueType=\"NO\"/>\n        <relationship name=\"client\" optional=\"YES\" maxCount=\"1\" deletionRule=\"Nullify\" destinationEntity=\"NOClient\" inverseName=\"activities\" inverseEntity=\"NOClient\"/>\n    </entity>\n    <entity name=\"NOCall\" representedClassName=\"NOCall\" syncable=\"YES\">\n        <attribute name=\"active\" attributeType=\"Boolean\" defaultValueString=\"YES\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"createdAt\" attributeType=\"Date\" usesScalarValueType=\"NO\"/>\n        <attribute name=\"endDate\" optional=\"YES\" attributeType=\"Date\" usesScalarValueType=\"NO\"/>\n        <attribute name=\"isSuitableForPush\" optional=\"YES\" attributeType=\"Boolean\" defaultValueString=\"NO\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"scheduledDate\" attributeType=\"Date\" usesScalarValueType=\"NO\"/>\n        <attribute name=\"scheduledDuration\" attributeType=\"Integer 64\" defaultValueString=\"0\"/>\n        <attribute name=\"startDate\" optional=\"YES\" attributeType=\"Date\" usesScalarValueType=\"NO\"/>\n        <attribute name=\"syncRevision\" optional=\"YES\" attributeType=\"Integer 64\" defaultValueString=\"0\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"updatedAt\" attributeType=\"Date\" usesScalarValueType=\"NO\"/>\n        <attribute name=\"uuid\" attributeType=\"UUID\" usesScalarValueType=\"NO\"/>\n        <relationship name=\"subscription\" optional=\"YES\" maxCount=\"1\" deletionRule=\"Nullify\" destinationEntity=\"NOSubscription\" inverseName=\"calls\" inverseEntity=\"NOSubscription\"/>\n    </entity>\n    <entity name=\"NOCity\" representedClassName=\"NOCity\" syncable=\"YES\">\n        <attribute name=\"active\" attributeType=\"Boolean\" defaultValueString=\"YES\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"createdAt\" attributeType=\"Date\" usesScalarValueType=\"NO\"/>\n        <attribute name=\"isSuitableForPush\" optional=\"YES\" attributeType=\"Boolean\" defaultValueString=\"NO\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"name\" attributeType=\"String\" minValueString=\"2\" maxValueString=\"100\"/>\n        <attribute name=\"nameArabic\" optional=\"YES\" attributeType=\"String\" minValueString=\"2\" maxValueString=\"100\"/>\n        <attribute name=\"syncRevision\" optional=\"YES\" attributeType=\"Integer 64\" defaultValueString=\"0\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"updatedAt\" attributeType=\"Date\" usesScalarValueType=\"NO\"/>\n        <attribute name=\"uuid\" attributeType=\"UUID\" usesScalarValueType=\"NO\"/>\n        <relationship name=\"country\" optional=\"YES\" maxCount=\"1\" deletionRule=\"Nullify\" destinationEntity=\"NOCountry\" inverseName=\"cities\" inverseEntity=\"NOCountry\"/>\n    </entity>\n    <entity name=\"NOClient\" representedClassName=\"NOClient\" syncable=\"YES\">\n        <attribute name=\"active\" attributeType=\"Boolean\" defaultValueString=\"YES\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"activityLevel\" attributeType=\"Integer 16\" minValueString=\"0\" maxValueString=\"6\" defaultValueString=\"0\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"allergies\" optional=\"YES\" attributeType=\"String\" minValueString=\"1\" maxValueString=\"10000\"/>\n        <attribute name=\"braintreeCustomer\" optional=\"YES\" attributeType=\"String\"/>\n        <attribute name=\"createdAt\" attributeType=\"Date\" usesScalarValueType=\"NO\"/>\n        <attribute name=\"dietGoal\" attributeType=\"String\" minValueString=\"1\" maxValueString=\"10000\"/>\n        <attribute name=\"foodDislikes\" optional=\"YES\" attributeType=\"String\" minValueString=\"1\" maxValueString=\"10000\"/>\n        <attribute name=\"height\" attributeType=\"Double\" minValueString=\"30\" maxValueString=\"300\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"isSuitableForPush\" optional=\"YES\" attributeType=\"Boolean\" defaultValueString=\"NO\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"occupation\" optional=\"YES\" attributeType=\"String\" minValueString=\"1\" maxValueString=\"100\"/>\n        <attribute name=\"syncRevision\" optional=\"YES\" attributeType=\"Integer 64\" defaultValueString=\"0\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"tapCustomer\" optional=\"YES\" attributeType=\"String\"/>\n        <attribute name=\"updatedAt\" attributeType=\"Date\" usesScalarValueType=\"NO\"/>\n        <attribute name=\"uuid\" attributeType=\"UUID\" usesScalarValueType=\"NO\"/>\n        <attribute name=\"weightGoal\" optional=\"YES\" attributeType=\"Double\" usesScalarValueType=\"NO\"/>\n        <relationship name=\"activities\" optional=\"YES\" toMany=\"YES\" deletionRule=\"Nullify\" destinationEntity=\"NOActivity\" inverseName=\"client\" inverseEntity=\"NOActivity\"/>\n        <relationship name=\"baseUser\" optional=\"YES\" maxCount=\"1\" deletionRule=\"Nullify\" destinationEntity=\"NOUser\" inverseName=\"client\" inverseEntity=\"NOUser\"/>\n        <relationship name=\"clientAssociatedReminders\" optional=\"YES\" toMany=\"YES\" deletionRule=\"Nullify\" destinationEntity=\"NOReminder\" inverseName=\"client\" inverseEntity=\"NOReminder\"/>\n        <relationship name=\"favouriteCurrency\" optional=\"YES\" maxCount=\"1\" deletionRule=\"Nullify\" destinationEntity=\"NOCurrency\" inverseName=\"favouriteOfClients\" inverseEntity=\"NOCurrency\"/>\n        <relationship name=\"favouriteSpecialistAssociation\" optional=\"YES\" maxCount=\"1\" deletionRule=\"Nullify\" destinationEntity=\"NOClientSpecialistAssociation\" inverseName=\"favouriteOfAClient\" inverseEntity=\"NOClientSpecialistAssociation\"/>\n        <relationship name=\"favouriteSubscription\" optional=\"YES\" maxCount=\"1\" deletionRule=\"Nullify\" destinationEntity=\"NOSubscription\" inverseName=\"favouriteOfAClient\" inverseEntity=\"NOSubscription\"/>\n        <relationship name=\"mealItems\" optional=\"YES\" toMany=\"YES\" deletionRule=\"Nullify\" destinationEntity=\"NOMealDetails\" inverseName=\"client\" inverseEntity=\"NOMealDetails\"/>\n        <relationship name=\"notesAboutClient\" optional=\"YES\" toMany=\"YES\" deletionRule=\"Nullify\" destinationEntity=\"NONote\" inverseName=\"client\" inverseEntity=\"NONote\"/>\n        <relationship name=\"notificationPermissions\" optional=\"YES\" maxCount=\"1\" deletionRule=\"Nullify\" destinationEntity=\"NONotificationPermissionsClient\" inverseName=\"client\" inverseEntity=\"NONotificationPermissionsClient\"/>\n        <relationship name=\"specialistAssociations\" optional=\"YES\" toMany=\"YES\" deletionRule=\"Nullify\" destinationEntity=\"NOClientSpecialistAssociation\" inverseName=\"client\" inverseEntity=\"NOClientSpecialistAssociation\"/>\n        <relationship name=\"subscriptions\" optional=\"YES\" toMany=\"YES\" deletionRule=\"Nullify\" destinationEntity=\"NOSubscription\" inverseName=\"client\" inverseEntity=\"NOSubscription\"/>\n        <relationship name=\"weightHistory\" optional=\"YES\" toMany=\"YES\" deletionRule=\"Nullify\" destinationEntity=\"NOWeightHistory\" inverseName=\"client\" inverseEntity=\"NOWeightHistory\"/>\n    </entity>\n    <entity name=\"NOClientSpecialistAssociation\" representedClassName=\"NOClientSpecialistAssociation\" syncable=\"YES\">\n        <attribute name=\"active\" attributeType=\"Boolean\" defaultValueString=\"YES\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"createdAt\" attributeType=\"Date\" usesScalarValueType=\"NO\"/>\n        <attribute name=\"firstConsultationCompleted\" optional=\"YES\" attributeType=\"Boolean\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"isSuitableForPush\" optional=\"YES\" attributeType=\"Boolean\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"syncRevision\" optional=\"YES\" attributeType=\"Integer 64\" defaultValueString=\"0\" usesScalarValueType=\"YES\"/>\n        <attribute name=\"updatedAt\" attributeType=\"Date\" usesScalarValueType=\"NO\"/>\n        <attribute name=\"uuid\" attributeType=\"UUID\" usesScalarValueType=\"NO\"/>\n        <attribute name=\"weightGoal\" optional=\"YES\" attributeType=\"Double\" usesScalarValueType=\"YES\"/>\n        <relationship name=\"client\" optional=\"YES\" maxCount=\"1\" deletionRule=\"Nullify\" destinationEntity=\"NOClient\" inverseName=\"specialistAssociations\" inverseEntity=\"NOClient\"/>\n        <relationship name=\"favouriteOfAClient\" optional=\"YES\" maxCount=\"1\" deletionRule=\"Nullify\" destinationEntity=\"NOClient\" inverseName=\"favouriteSpecialistAssociation\" inverseEntity=\"NOClient\"/>\n        <relationship name=\"specialist\" optional=\"YES\" maxCount=\"1\" deletionRule=\"Nullify\" destinationEntity=\"NODietitian\" inverseName=\"clientAssociations\" inverseEntity=\"NODietitian\"/>\n        <relationship name=\"subscriptions\" optional=\"YES\" toMany=\"YES\" deletionRule=\"Nullify\" destinationEntity=\"NOSubscription\" inverseName=\"clientSpecialistAssociation\" inverseEntity=\"NOSubscription\"/>\n        <relationship name=\"weightGoals\" optional=\"YES\" toMany=\"YES\" deletionRule=\"Nullify\" destinationEntity=\"NOWeightGoal\" inverseName=\"clientSpecialistAssociation\" inverseEntity=\"NOWeightGoal\"/>\n    </entity>\n    <elements>\n        <element name=\"NOActivity\" positionX=\"-1437.57421875\" positionY=\"-1335.015625\" width=\"128\" height=\"253\"/>\n        <element name=\"NOCall\" positionX=\"-994.8828125\" positionY=\"-938.5234375\" width=\"128\" height=\"208\"/>\n        <element name=\"NOCity\" positionX=\"-1224\" positionY=\"-1170\" width=\"128\" height=\"163\"/>\n        <element name=\"NOClient\" positionX=\"-1257.03125\" positionY=\"-1327.1171875\" width=\"128\" height=\"448\"/>\n        <element name=\"NOClientSpecialistAssociation\" positionX=\"-1233\" positionY=\"-1179\" width=\"128\" height=\"223\"/>\n        <element name=\"NOCountry\" positionX=\"-1233\" positionY=\"-1179\" width=\"128\" height=\"178\"/>\n        <element name=\"NOCurrency\" positionX=\"160\" positionY=\"192\" width=\"128\" height=\"223\"/>\n        <element name=\"NODietitian\" positionX=\"-384.140625\" positionY=\"-893.14453125\" width=\"128\" height=\"673\"/>\n        <element name=\"NODietitianStatistics\" positionX=\"-209.859375\" positionY=\"-894.484375\" width=\"128\" height=\"269\"/>\n        <element name=\"NOIssueReport\" positionX=\"-1242\" positionY=\"-1188\" width=\"128\" height=\"208\"/>\n        <element name=\"NOIssueReportItem\" positionX=\"-1242\" positionY=\"-1188\" width=\"128\" height=\"164\"/>\n        <element name=\"NOLanguage\" positionX=\"-1428.68359375\" positionY=\"-967.12109375\" width=\"128\" height=\"164\"/>\n        <element name=\"NOLocation\" positionX=\"-867.11328125\" positionY=\"-733.4765625\" width=\"128\" height=\"194\"/>\n        <element name=\"NOMealDetails\" positionX=\"-816.55078125\" positionY=\"-1320.86328125\" width=\"178.2109375\" height=\"358\"/>\n        <element name=\"NOMealPlan\" positionX=\"-563.921875\" positionY=\"-1319.203125\" width=\"128\" height=\"224\"/>\n        <element name=\"NOMessage\" positionX=\"-1363.1796875\" positionY=\"-762.3125\" width=\"128\" height=\"343\"/>\n        <element name=\"NONote\" positionX=\"-172.98046875\" positionY=\"-1292.90234375\" width=\"128\" height=\"179\"/>\n        <element name=\"NONotification\" positionX=\"-1249.51953125\" positionY=\"-486.62890625\" width=\"128\" height=\"254\"/>\n        <element name=\"NONotificationPermissionsClient\" positionX=\"-1041.0234375\" positionY=\"-1158.72265625\" width=\"128\" height=\"209\"/>\n        <element name=\"NONotificationPermissionsDietitian\" positionX=\"-534.94140625\" positionY=\"-1060.34375\" width=\"128\" height=\"239\"/>\n        <element name=\"NORefundPolicy\" positionX=\"160\" positionY=\"192\" width=\"128\" height=\"193\"/>\n        <element name=\"NOReminder\" positionX=\"-1242\" positionY=\"-1188\" width=\"128\" height=\"194\"/>\n        <element name=\"NOSpeciality\" positionX=\"-1242\" positionY=\"-1188\" width=\"128\" height=\"178\"/>\n        <element name=\"NOStatisticsAgeGroup\" positionX=\"-54.16015625\" positionY=\"-1054.7890625\" width=\"128\" height=\"209\"/>\n        <element name=\"NOStatisticsMonthly\" positionX=\"-27.9609375\" positionY=\"-789.63671875\" width=\"128\" height=\"194\"/>\n        <element name=\"NOStatisticsRegion\" positionX=\"9.90234375\" positionY=\"-445.828125\" width=\"128\" height=\"194\"/>\n        <element name=\"NOSubscription\" positionX=\"-847.48828125\" positionY=\"-966.7890625\" width=\"128\" height=\"299\"/>\n        <element name=\"NOSubscriptionPlan\" positionX=\"-678.390625\" positionY=\"-918.39453125\" width=\"128\" height=\"448\"/>\n        <element name=\"NOSubscriptionPlanStatistics\" positionX=\"-865.7578125\" positionY=\"-534.5\" width=\"128\" height=\"269\"/>\n        <element name=\"NOSynchData\" positionX=\"-1437.36328125\" positionY=\"-1107.19921875\" width=\"128\" height=\"119\"/>\n        <element name=\"NOSystemSubscription\" positionX=\"-1233\" positionY=\"-1179\" width=\"128\" height=\"193\"/>\n        <element name=\"NOUser\" positionX=\"-1145.83203125\" positionY=\"-897.671875\" width=\"128\" height=\"493\"/>\n        <element name=\"NOVerificationRequest\" positionX=\"-184.1484375\" positionY=\"-445.1875\" width=\"128\" height=\"163\"/>\n        <element name=\"NOVerificationRequestItem\" positionX=\"-49.2890625\" positionY=\"-618.6796875\" width=\"128\" height=\"178\"/>\n        <element name=\"NOVirtualClinic\" positionX=\"-1242\" positionY=\"-1188\" width=\"128\" height=\"463\"/>\n        <element name=\"NOWeightHistory\" positionX=\"-1063.1953125\" positionY=\"-1330.47265625\" width=\"128\" height=\"164\"/>\n        <element name=\"NOWeightGoal\" positionX=\"-1233\" positionY=\"-1179\" width=\"128\" height=\"223\"/>\n    </elements>\n</model>\n";

const expectedModelParserResponseFragment = {
  model: {
    version: 1,
    entities: {
      NOActivity: {
        name: 'NOActivity',
        syncable: true,
        attributes: {
          active: {
            name: 'active',
            optional: false,
            attributeType: 'Boolean',
          },
          client: {
            name: 'client',
            optional: true,
            attributeType: 'relationship',
          },
        },
      },
    },
  },
  validationSchema: {
    NOActivity: {
      attributes: {
        active: {
          type: 'boolean',
          constraints: {
            required: true,
          },
        },
        exerciseType: {
          type: 'string',
          constraints: {
            required: true,
            minLength: 1,
            maxLength: 100,
          },
        },
      },
      relationships: {
        client: {
          destinationEntity: 'NOClient',
          toMany: false,
        },
      },
    },
  },
};

describe('model parsing', () => {
  test("model parser doesn't throw", () => {
    expect(() => {
      modelParser(modelFragment);
    }).not.toThrow();
  });

  test("model parser returns db schema and validation schema", () => {
    const parsedModel = modelParser(modelFragment);
    expect(parsedModel).toHaveProperty('model');
    expect(parsedModel).toHaveProperty('validationSchema');
    expect(parsedModel).toMatchObject(expectedModelParserResponseFragment);
  })
});
